--- a/libdjvu/Makefile.am
+++ b/libdjvu/Makefile.am
@@ -33,6 +33,8 @@
 libdjvulibre_la_LDFLAGS = -no-undefined -version-info $(version_info)
 
 if HAVE_OS_WIN32
+libdjvulibre_la_CPPFLAGS += -DDJVUAPI_EXPORT
+libdjvulibre_la_CPPFLAGS += -DDDJVUAPI_EXPORT -DMINILISPAPI_EXPORT
 libdjvulibre_la_LDFLAGS += -Wl,--export-all-symbols
 endif
 
--- a/libdjvu/miniexp.cpp
+++ b/libdjvu/miniexp.cpp
@@ -383,14 +383,16 @@
 }
 # endif
 // -- Very black magic to clean tls variables.
+/*
 # ifdef _M_IX86
 #  pragma comment (linker, "/INCLUDE:_tlscb")
 # else
 #  pragma comment (linker, "/INCLUDE:tlscb")
 # endif
 # pragma const_seg(".CRT$XLB")
+*/
 extern "C" PIMAGE_TLS_CALLBACK tlscb = gctls_cb;
-# pragma const_seg()
+/* # pragma const_seg() */
 
 #else
 // No threads
